@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  --background: hsl(0, 0%, 100%);
  --foreground: hsl(20, 14.3%, 4.1%);
  --muted: hsl(60, 4.8%, 95.9%);
  --muted-foreground: hsl(25, 5.3%, 44.7%);
  --popover: hsl(0, 0%, 100%);
  --popover-foreground: hsl(20, 14.3%, 4.1%);
  --card: hsl(0, 0%, 100%);
  --card-foreground: hsl(20, 14.3%, 4.1%);
  --border: hsl(20, 5.9%, 90%);
  --input: hsl(20, 5.9%, 90%);
  --primary: hsl(267, 84%, 81%);
  --primary-foreground: hsl(211, 100%, 99%);
  --secondary: hsl(156, 77%, 73%);
  --secondary-foreground: hsl(24, 9.8%, 10%);
  --accent: hsl(39, 85%, 94%);
  --accent-foreground: hsl(24, 9.8%, 10%);
  --destructive: hsl(0, 84.2%, 60.2%);
  --destructive-foreground: hsl(60, 9.1%, 97.8%);
  --ring: hsl(20, 14.3%, 4.1%);
  --radius: 0.5rem;

  /* Custom colors for mental health app */
  --primary-light: hsl(278, 68%, 87%);
  --cloud: hsl(39, 85%, 94%);
  --sprout: hsl(137, 72%, 84%);
  --warm-gray: hsl(220, 14%, 98%);
  --soft-purple: hsl(270, 100%, 97%);
  --soft-pink: hsl(322, 100%, 96%);
  --soft-blue: hsl(214, 100%, 97%);

  /* Font size variables for mobile optimization */
  --font-size-xs: 0.75rem; /* 12px */
  --font-size-sm: 0.875rem; /* 14px */
  --font-size-base: 1rem; /* 16px */
  --font-size-lg: 1.125rem; /* 18px */
  --font-size-xl: 1.25rem; /* 20px */
  --font-size-2xl: 1.5rem; /* 24px */
  --font-size-3xl: 1.875rem; /* 30px */

  /* User font size setting (default: medium) */
  --user-font-scale: 1;
}

.dark {
  --background: hsl(240, 10%, 3.9%);
  --foreground: hsl(0, 0%, 98%);
  --muted: hsl(240, 3.7%, 15.9%);
  --muted-foreground: hsl(240, 5%, 64.9%);
  --popover: hsl(240, 10%, 3.9%);
  --popover-foreground: hsl(0, 0%, 98%);
  --card: hsl(240, 10%, 3.9%);
  --card-foreground: hsl(0, 0%, 98%);
  --border: hsl(240, 3.7%, 15.9%);
  --input: hsl(240, 3.7%, 15.9%);
  --primary: hsl(267, 84%, 81%);
  --primary-foreground: hsl(211, 100%, 99%);
  --secondary: hsl(240, 3.7%, 15.9%);
  --secondary-foreground: hsl(0, 0%, 98%);
  --accent: hsl(240, 3.7%, 15.9%);
  --accent-foreground: hsl(0, 0%, 98%);
  --destructive: hsl(0, 62.8%, 30.6%);
  --destructive-foreground: hsl(0, 0%, 98%);
  --ring: hsl(240, 4.9%, 83.9%);
  --radius: 0.5rem;
}

@layer base {
  * {
    @apply border-border;
  }

  body {
    @apply font-sans antialiased bg-background text-foreground;
    /* 접근성 최적화 - 사용자 폰트 크기 설정 반영 */
    font-size: calc(1rem * var(--user-font-scale));
    line-height: 1.6;
    -webkit-text-size-adjust: 100%;
    text-size-adjust: 100%;
    font-size-adjust: auto;
    /* 키보드 입력 시 화면 줌 방지 */
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    -khtml-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
  }

  /* 입력 필드에서는 사용자 선택 허용 */
  input,
  textarea {
    -webkit-user-select: text;
    -khtml-user-select: text;
    -moz-user-select: text;
    -ms-user-select: text;
    user-select: text;
    /* iOS에서 키보드 입력 시 줄 방지 + 사용자 폰트 크기 반영 */
    font-size: max(1rem, calc(var(--font-size-base) * var(--user-font-scale)));
  }

  /* 모바일 버튼 최소 터치 크기 */
  button,
  .btn {
    min-height: 44px;
    min-width: 44px;
  }

  /* 모바일 최적화 기본 여백 */
  .container,
  main {
    padding-left: 1rem;
    padding-right: 1rem;
  }

  /* 사용자 폰트 크기 설정을 반영하는 상대적 텍스트 크기 */
  h1 {
    font-size: calc(1.5rem * var(--user-font-scale));
    line-height: 1.3;
    margin: calc(1rem * var(--user-font-scale)) 0;
  }

  h2 {
    font-size: calc(1.25rem * var(--user-font-scale));
    line-height: 1.4;
    margin: calc(0.875rem * var(--user-font-scale)) 0;
  }

  h3 {
    font-size: calc(1.125rem * var(--user-font-scale));
    line-height: 1.4;
    margin: calc(0.75rem * var(--user-font-scale)) 0;
  }

  p,
  span,
  div {
    line-height: 1.6;
    margin: calc(0.5rem * var(--user-font-scale)) 0;
  }

  /* 반응형 미디어 쿼리 - 사용자 설정 반영 */
  @media (min-width: 768px) {
    h1 {
      font-size: calc(2rem * var(--user-font-scale));
    }

    h2 {
      font-size: calc(1.5rem * var(--user-font-scale));
    }

    h3 {
      font-size: calc(1.25rem * var(--user-font-scale));
    }
  }

  @media (min-width: 1024px) {
    h1 {
      font-size: calc(2.5rem * var(--user-font-scale));
    }

    h2 {
      font-size: 1.875rem; /* 30px */
    }

    h3 {
      font-size: 1.5rem; /* 24px */
    }
  }
}

@layer components {
  /* 모바일 최적화 클래스 */
  .mobile-container {
    @apply px-4 sm:px-6 lg:px-8;
  }

  .mobile-text {
    @apply text-sm sm:text-base lg:text-lg;
  }

  .mobile-title {
    @apply text-lg sm:text-xl lg:text-2xl;
  }

  .mobile-button {
    @apply min-h-[44px] min-w-[44px] px-4 py-2 text-base;
  }

  .mobile-card {
    @apply p-4 sm:p-6 lg:p-8;
  }

  .mobile-grid {
    @apply grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4;
  }

  .mobile-flex {
    @apply flex flex-col sm:flex-row;
  }

  .mobile-input {
    @apply h-12 text-base;
    font-size: max(16px, 1rem); /* iOS 줌 방지 */
  }

  .mobile-form {
    @apply space-y-4 sm:space-y-6;
  }

  /* 기존 클래스들 */
  .gradient-primary {
    background: linear-gradient(
      135deg,
      hsl(var(--primary)),
      hsl(var(--secondary))
    );
  }

  .gradient-soft {
    background: linear-gradient(
      135deg,
      hsl(var(--soft-purple)),
      hsl(var(--cloud))
    );
  }

  .card-healing {
    @apply bg-white/90 backdrop-blur-sm rounded-3xl shadow-xl border border-white/20;
  }

  .character-float {
    animation: float 3s ease-in-out infinite;
  }

  .character-bounce {
    animation: bounce 2s ease-in-out infinite;
  }

  /* 3D 입체감을 위한 전역 클래스 */
  .card-3d {
    transform-style: preserve-3d;
    transition: all 0.3s ease;
    box-shadow:
      0 4px 6px -1px rgba(0, 0, 0, 0.1),
      0 2px 4px -1px rgba(0, 0, 0, 0.06),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
  }

  .card-3d:hover {
    transform: translateY(-4px) rotateX(2deg);
    box-shadow:
      0 25px 50px -12px rgba(0, 0, 0, 0.25),
      0 0 0 1px rgba(255, 255, 255, 0.1);
  }

  .card-3d:active {
    transform: translateY(-2px) rotateX(1deg);
  }

  /* 텍스트 균형 */
  .text-balance {
    text-wrap: balance;
  }

  /* 안전한 애니메이션 */
  @media (prefers-reduced-motion: reduce) {
    .character-float,
    .character-bounce,
    .card-3d {
      animation: none;
      transform: none;
    }
  }
}

/* 애니메이션 키프레임 */
@keyframes float {
  0%,
  100% {
    transform: translateY(0px) rotate(0deg);
  }
  50% {
    transform: translateY(-10px) rotate(1deg);
  }
}

@keyframes bounce {
  0%,
  100% {
    transform: translateY(0px) scale(1);
  }
  50% {
    transform: translateY(-5px) scale(1.02);
  }
}

/* 모바일 스크롤 최적화 */
.mobile-scroll {
  @apply overflow-y-auto;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
}

/* 키보드 안전 영역 */
.keyboard-safe {
  padding-bottom: env(keyboard-inset-height, 0px);
}

/* 폰트 크기 클래스 - 접근성 지원 */
.font-size-xs {
  --user-font-scale: 0.8;
}
.font-size-sm {
  --user-font-scale: 0.9;
}
.font-size-base {
  --user-font-scale: 1;
}
.font-size-lg {
  --user-font-scale: 1.1;
}
.font-size-xl {
  --user-font-scale: 1.2;
}
.font-size-xxl {
  --user-font-scale: 1.3;
}

/* 추가 모바일 최적화 유틸리티 */
.mobile-chat {
  flex: 1;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

.mobile-chat-header {
  padding: calc(0.75rem * var(--user-font-scale))
    calc(1rem * var(--user-font-scale));
  flex-shrink: 0;
}

.safe-bottom {
  padding-bottom: calc(
    1rem * var(--user-font-scale) + env(safe-area-inset-bottom, 0px)
  );
}

/* 텍스트 컨테이너 최대 폭 제한 - 가독성 향상 */
.text-container {
  max-width: 65ch;
  margin: 0 auto;
}

/* 유연한 레이아웃 - 폰트 크기 변화에 대응 */
.flexible-layout {
  display: flex;
  flex-wrap: wrap;
  gap: calc(1rem * var(--user-font-scale));
  align-items: flex-start;
}
